<?xml version="1.0"?>
<deployment>
    <system>
        <name>de2o_test</name>
        <id>design_id_1234</id>
    </system>
    <infra>
        <aliyun>
            <region>cn-hongkong</region>
            <vpcs>
                <vpc>
                    <name>de2o_vpc</name>
                    <description>vpc#1</description>
                    <cidr>10.10.0.0/16</cidr>
                    <id></id>
                </vpc>
            </vpcs>
            <vswitchs>
                <vswitch>
                    <name>de2o_vswitch</name>
                    <description>subnet#1</description>
                    <vpc_name>de2o_vpc</vpc_name>
                    <zone_id>cn-hongkong-b</zone_id>
                    <cidr>10.10.1.0/24</cidr>
                    <id></id>
                </vswitch>
                <vswitch>
                    <name>de2o_vswitch2</name>
                    <vpc_name>de2o_vpc</vpc_name>
                    <zone_id>cn-hongkong-c</zone_id>
                    <cidr>10.10.2.0/24</cidr>
                    <id></id>
                </vswitch>
            </vswitchs>
            <vrouters/>
            <security_groups>
                <security_group>
                    <name>de2o_security_was</name>
                    <description>security group #1</description>
                    <vpc_name>de2o_vpc</vpc_name>
                    <rules>
                        <rule>  <!-- required from UI -->
                            <ip_protocol>tcp</ip_protocol>
                            <port_range>22/22</port_range>
                            <source_cidr_ip>0.0.0.0/0</source_cidr_ip>
                            <description>security group rule #1</description>
                            <!--
                            <policy>accept</policy>
                            <priority>1</priority>
                            -->
                        </rule>
                        <rule>
                            <ip_protocol>tcp</ip_protocol>
                            <port_range>80/80</port_range>
                            <source_cidr_ip>0.0.0.0/0</source_cidr_ip>
                            <description>security group rule #2</description>
                        </rule>
                        <rule>
                            <ip_protocol>tcp</ip_protocol>
                            <port_range>8080/8080</port_range>
                            <source_cidr_ip>0.0.0.0/0</source_cidr_ip>
                        </rule>
                    </rules>
                    <id></id>
                </security_group>
                <security_group>
                    <name>de2o_security_db</name>
                    <description>security group #2</description>
                    <vpc_name>de2o_vpc</vpc_name>
                    <rules>
                        <rule>  <!-- required from UI -->
                            <ip_protocol>tcp</ip_protocol>
                            <port_range>22/22</port_range>
                            <source_cidr_ip>0.0.0.0/0</source_cidr_ip>
                            <description>security group rule #1</description>
                        </rule>
                        <rule>
                            <ip_protocol>tcp</ip_protocol>
                            <port_range>3306/3306</port_range>
                            <source_cidr_ip>0.0.0.0/0</source_cidr_ip>
                            <description>security group rule #2</description>
                        </rule>
                    </rules>
                    <id></id>
                </security_group>
            </security_groups>
            <instances>
                <instance>
                    <name>de2o_1</name>
                    <password>mypasswd00!</password>
                    <image>centos_7_2_64_40G_base_20170222.vhd</image>
                    <size>ecs.n4.small</size>
                    <!-- <zone_id>cn-hongkong-b</zone_id> automatically selected by the system -->
                    <description>ECS Instance Description</description>
                    <hostname>alpha</hostname>
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <internet_max_bandwidth_out>100</internet_max_bandwidth_out>
                    <internet_max_bandwidth_in>100</internet_max_bandwidth_in>
                    <security_group_name>de2o_security_was</security_group_name>
                    <vswitch_name>de2o_vswitch</vswitch_name>
                    <private_ip_address>10.10.1.1</private_ip_address>
                    <id></id>
                    <!--
                    <io_optimized>true</io_optimized>
                    <system_disk>
                        <category>cloud_efficiency</category>
                        <size>50</size>
                        <name>sys-disk</name>
                        <description>System disk of alpha</description>
                    </system_disk>
                    <data_disks>
                        <data_disk>
                            <category>cloud_efficiency</category>
                            <size>100</size>
                            <name>data-disk-1</name>
                            <description>Data disk #1 of alpha</description>
                            <delete_with_instance>true</delete_with_instance>
                        </data_disk>
                        <data_disk>
                            <category>cloud_efficiency</category>
                            <name>data-disk-2</name>
                            <description>Data disk #2 of alpha</description>
                            <delete_with_instance>true</delete_with_instance>
                        </data_disk>
                    </data_disks>
                    <keypair_name></keypair_name>
                    -->
                </instance>
                <instance>
                    <name>de2o_2</name>
                    <password>mypasswd00!</password>
                    <image>centos_7_2_64_40G_base_20170222.vhd</image>
                    <size>ecs.n4.small</size>
                    <description>ECS Instance Description</description>
                    <hostname>bravo</hostname>
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <internet_max_bandwidth_out>100</internet_max_bandwidth_out>
                    <internet_max_bandwidth_in>100</internet_max_bandwidth_in>
                    <security_group_name>de2o_security_was</security_group_name>
                    <vswitch_name>de2o_vswitch</vswitch_name>
                    <private_ip_address>10.10.1.2</private_ip_address>
                    <id></id>
                </instance>
                <instance>
                    <name>de2o_3</name>
                    <password>mypasswd00!</password>
                    <image>centos_7_2_64_40G_base_20170222.vhd</image>
                    <size>ecs.n4.small</size>
                    <description>ECS Instance Description</description>
                    <hostname>alpha</hostname>
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <internet_max_bandwidth_out>100</internet_max_bandwidth_out>
                    <internet_max_bandwidth_in>100</internet_max_bandwidth_in>
                    <security_group_name>de2o_security_db</security_group_name>
                    <vswitch_name>de2o_vswitch2</vswitch_name>
                    <private_ip_address>10.10.2.1</private_ip_address>
                    <id></id>
                </instance>
                <instance>
                    <name>de2o_4</name>
                    <password>mypasswd00!</password>
                    <image>centos_7_2_64_40G_base_20170222.vhd</image>
                    <size>ecs.n4.small</size>
                    <description>ECS Instance Description</description>
                    <hostname>bravo</hostname>
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <internet_max_bandwidth_out>100</internet_max_bandwidth_out>
                    <internet_max_bandwidth_in>100</internet_max_bandwidth_in>
                    <security_group_name>de2o_security_db</security_group_name>
                    <vswitch_name>de2o_vswitch2</vswitch_name>
                    <private_ip_address>10.10.2.2</private_ip_address>
                    <id></id>
                </instance>
            </instances>
            <eips>
                <eip>
                    <instance_name>de2o_1</instance_name>
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <!--
                    <max_bandwidth>5</max_bandwidth>
                    <release_with_instance>false</release_with_instance>
                    -->
                    <id></id>
                    <address></address>
                </eip>
                <eip>
                    <instance_name>de2o_2</instance_name>
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <!--
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <max_bandwidth>5</max_bandwidth>
                    <release_with_instance>false</release_with_instance>
                    -->
                    <id></id>
                    <address></address>
                </eip>
                <eip>
                    <instance_name>de2o_3</instance_name>
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <!--
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <max_bandwidth>5</max_bandwidth>
                    <release_with_instance>false</release_with_instance>
                    -->
                    <id></id>
                    <address></address>
                </eip>
                <eip>
                    <instance_name>de2o_4</instance_name>
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <!--
                    <internet_charge_type>PayByTraffic</internet_charge_type>
                    <max_bandwidth>5</max_bandwidth>
                    <release_with_instance>false</release_with_instance>
                    -->
                    <id></id>
                    <address></address>
                </eip>
            </eips>
            <loadbalancers>
                <loadbalancer>
                    <name>de2o_slb_name</name>
                    <port>80</port>
                    <members>
                        <member>
                            <instance_name>de2o_1</instance_name>
                            <port>80</port>
                        </member>
                        <member>
                            <instance_name>de2o_2</instance_name>
                            <port>80</port>
                        </member>
                    </members>
                    <protocol>http</protocol>
                    <algorithm>ROUND_ROBIN</algorithm>
                    <listener>
                        <sticky_session>off</sticky_session>
                        <health_check>
                            <connect_port>80</connect_port>
                            <check_uri>/index.html</check_uri>
                            <check_timeout>3</check_timeout>
                            <check_interval>3</check_interval>
                            <healthy_threshold>3</healthy_threshold>
                            <unhealthy_threshold>3</unhealthy_threshold>
                        </health_check>
                    </listener>
                    <id></id>
                </loadbalancer>
                <loadbalancer>
                    <name>de2o_slb_name2</name>
                    <port>8080</port>
                    <members>
                        <member>
                            <instance_name>de2o_1</instance_name>
                            <port>8080</port>
                        </member>
                        <member>
                            <instance_name>de2o_2</instance_name>
                            <port>8080</port>
                        </member>
                    </members>
                    <protocol>http</protocol>
                    <algorithm>ROUND_ROBIN</algorithm>
                    <listener>
                        <sticky_session>on</sticky_session>
                        <health_check>
                            <connect_port>8080</connect_port>
                            <check_uri>/index.html</check_uri>
                            <check_timeout>3</check_timeout>
                            <check_interval>3</check_interval>
                            <healthy_threshold>3</healthy_threshold>
                            <unhealthy_threshold>3</unhealthy_threshold>
                        </health_check>
                    </listener>
                    <id></id>
                </loadbalancer>
                <loadbalancer>
                    <name>de2o_slb_name3</name>
                    <port>3306</port>
                    <members>
                        <member>
                            <instance_name>de2o_3</instance_name>
                            <port>3306</port>
                        </member>
                        <member>
                            <instance_name>de2o_4</instance_name>
                            <port>3306</port>
                        </member>
                    </members>
                    <protocol>tcp</protocol>
                    <algorithm>LEAST_CONNECTIONS</algorithm>
                    <listener>
                        <sticky_session>off</sticky_session>
                        <health_check>
                            <connect_port>3306</connect_port>
                            <check_uri>/index2.html</check_uri>
                            <check_timeout>3</check_timeout>
                            <check_interval>3</check_interval>
                            <healthy_threshold>3</healthy_threshold>
                            <unhealthy_threshold>3</unhealthy_threshold>
                        </health_check>
                    </listener>
                    <id></id>
                </loadbalancer>
            </loadbalancers>
        </aliyun>
    </infra>
    <application>
        <saltstack>
            <master_ip>52.78.62.216</master_ip>
        </saltstack>
        <logical_servers>
            <logical_server>
                <name>logical_web</name>
                <servers>
                    <server>de2o_1</server>
                    <server>de2o_2</server>
                </servers>
                <loadbalancer_name>de2o_slb_name</loadbalancer_name>
            </logical_server>
            <logical_server>
                <name>logical_was</name>
                <servers>
                    <server>de2o_1</server>
                    <server>de2o_2</server>
                </servers>
                <loadbalancer_name>de2o_slb_name2</loadbalancer_name>
            </logical_server>
            <logical_server>
                <name>logical_db</name>
                <servers>
                    <server>de2o_3</server>
                    <server>de2o_4</server>
                </servers>
                <loadbalancer_name>de2o_slb_name3</loadbalancer_name>
            </logical_server>
        </logical_servers>
        <software>
            <nginx>
                <deploy_target>logical_web</deploy_target> <!--logical or physical server name -->
                <vhosts>
                    <vhost>
                        <name>www.petclinic.kr</name>
                        <ports>80</ports>
                        <server_admin>webmaster</server_admin>
                        <doc_root>/www/petc/htdocs</doc_root>
                        <log_root>/www/petc/logs/web</log_root>
                        <use_modproxy>true</use_modproxy>
                        <proxies>
                            <proxy>
                                <uri>/petclinic</uri>
                                <backend>http://localhost:8080</backend>
                            </proxy>
                            <proxy>
                                <ext>jsp</ext>
                                <backend>http://localhost:8080</backend>
                            </proxy>
                        </proxies>
                        <enable>false</enable>
                    </vhost>
                </vhosts>
            </nginx>
            <tomcat>
                <deploy_target>logical_was</deploy_target>
                <jdk>
                    <type>openjdk</type>
                    <version>1.8.0</version>
                </jdk>
                <install>
                    <install_home>/www/petclinic</install_home>
                    <tomcat_home>/www/petclinic/apache-tomcat-7.0.77</tomcat_home>
                    <java_opts>-server -Xms512m -Xmx512m -XX:PermSize=128m -XX:MaxPermSize=128m -XX:+DisableExplicitGC</java_opts>
                </install>
                <server>
                    <name>petclinic</name>
                    <http_port>8080</http_port>
                    <ajp_port>8009</ajp_port>
                    <app_base>webapps</app_base>
                    <contexts>
                        <context>
                            <path>/petclinic</path>
                            <doc_base>petclinic</doc_base>
                        </context>
                        <context>
                            <path>/test</path>
                            <doc_base>test</doc_base>
                        </context>
                    </contexts>
                </server>
            </tomcat>
            <mysql>
                <deploy_target>logical_db</deploy_target>
                <service_ip>server1</service_ip>  <!-- ????? -->
                <service_port>3306</service_port>
                <admin>
                    <user>root</user>
                    <password>petclinic</password>
                </admin>
                <ha>
                    <master_server>de2o_3</master_server>
                    <slave_server>de2o_4</slave_server>
                </ha>
            </mysql>
        </software>
    </application>
</deployment>

